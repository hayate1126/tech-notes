# ğŸ—ï¸ Modern Feature-Sliced Architecture (App Router Era)

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Next.js App Routerã®ç‰¹æ€§ã‚’æœ€å¤§é™ã«æ´»ã‹ã—ã¤ã¤ã€å¤§è¦æ¨¡é–‹ç™ºã§ã®ä¿å®ˆæ€§ã¨ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã‚’ä¸¡ç«‹ã•ã›ãŸ**ã€ŒFeature-Driven Atomic Architectureã€**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

## ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®æ±ºå®šç‰ˆãƒ„ãƒªãƒ¼

```text
src/
 â”œâ”€â”€ app/                   # ã€Server Layerã€‘ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° & RSC
 â”‚    â””â”€â”€ users/[id]/       # å„ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨Featureã®é…ç½®ã«å°‚å¿µ
 â”œâ”€â”€ features/              # ã€Feature Layerã€‘ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã®ã€Œå°ã•ãªå³¶ã€
 â”‚    â””â”€â”€ user-profile/     # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ©Ÿèƒ½ (ã‚«ãƒ—ã‚»ãƒ«åŒ–)
 â”‚         â”œâ”€â”€ components/  # ã“ã®æ©Ÿèƒ½å°‚ç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 â”‚         â”œâ”€â”€ hooks/       # Reactã®çŠ¶æ…‹ãƒ»å‰¯ä½œç”¨ (Interface)
 â”‚         â”œâ”€â”€ utils/     # ç´”ç²‹é–¢æ•°ã«ã‚ˆã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ« (Domain Logic)
 â”‚         â”œâ”€â”€ types/       # ã“ã®æ©Ÿèƒ½å°‚ç”¨ã®å‹å®šç¾©
 â”‚         â”œâ”€â”€ tests/       # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
 â”‚         â””â”€â”€ index.ts     # ã€Public APIã€‘å¤–éƒ¨ã¸ã®å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
 â”œâ”€â”€ components/            # ã€Shared UI Layerã€‘ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã‚¼ãƒ­ã®æ±ç”¨éƒ¨å“
 â”‚    â””â”€â”€ ui/               # Button, Modal, Avatarç­‰ (Shadcn/uiãƒ™ãƒ¼ã‚¹)
 â”œâ”€â”€ hooks/                 # ã€Global Hooksã€‘æ±ç”¨çš„ãªãƒ­ã‚¸ãƒƒã‚¯
 â”œâ”€â”€ lib/                   # å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆæœŸåŒ– (Prisma, Supabaseç­‰)
 â”œâ”€â”€ types/                   # ã‚°ãƒ­ãƒ¼ãƒãƒ«å‹å®šç¾©
 â”œâ”€â”€ stores/                   # ã‚¹ãƒˆã‚¢æ ¼ç´
 â””â”€â”€ utils/                 # ç´”ç²‹ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

```

---

## ğŸ¯ è¨­è¨ˆã®ã‚³ã‚¢åŸå‰‡

### 1. ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã¨ã€ŒUIã€ã®åˆ†é›¢

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã€ãã®å½¹å‰²ï¼ˆèªå½™ï¼‰ã«ã‚ˆã£ã¦æ˜ç¢ºã«2å±¤ã«åˆ†ã‘ã¦ã„ã¾ã™ã€‚

* **Shared UI(components):** ã‚¢ãƒ—ãƒªã®ç›®çš„ã‚’çŸ¥ã‚‰ãªã„æŠ½è±¡ãƒ‘ãƒ¼ãƒ„ï¼ˆButton, Avatarï¼‰ã€‚
* **Feature:** ã€ŒæŠ•ç¨¿ã€ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã¨ã„ã£ãŸãƒ“ã‚¸ãƒã‚¹ä¸Šã®æ„å‘³ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰ã‚’æŒã¤å¡Šã€‚éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨å…±é€šè¨€èªï¼ˆãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªï¼‰ã§è©±ã›ã‚‹å˜ä½ã§åˆ†å‰²ã—ã¦ã„ã¾ã™ã€‚

### 2. ãƒ­ã‚¸ãƒƒã‚¯ã®ã€ŒROIã€ã«åŸºã¥ã„ãŸé…ç½®

èªçŸ¥è² è·ã¨ä¿å®ˆæ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ãŸã‚ã€ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä»¥ä¸‹ã®3æ®µéšã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

* **View Logic:** UIã®é–‹é–‰ãªã©ã®è¡¨ç¤ºåˆ¶å¾¡ã¯ã€Colocationï¼ˆå…±é…ç½®ï¼‰ã«åŸºã¥ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«é–‰ã˜è¾¼ã‚ã¾ã™ã€‚
* **Domain Logic:** è¨ˆç®—ã‚„åˆ¤å®šãªã©ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¯ã€Reactã«ä¾å­˜ã—ãªã„**ç´”ç²‹é–¢æ•°**ã¨ã—ã¦ `logic.ts` ã«æŠ½å‡ºã€‚100%ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚
* **Interface Hooks:** çŠ¶æ…‹ç®¡ç†ã‚„å‰¯ä½œç”¨ï¼ˆAPIæ¥ç¶šï¼‰ã¯**Custom Hooks**ã«ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®£è¨€çš„ã«ä¿ã¡ã¾ã™ã€‚

### 3. å…¬é–‹APIã«ã‚ˆã‚‹ã‚«ãƒ—ã‚»ãƒ«åŒ– (`index.ts`)

å„ `features/` ãƒ•ã‚©ãƒ«ãƒ€ã¯ä¸€ã¤ã®ç‹¬ç«‹ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚ˆã†ã«æŒ¯ã‚‹èˆã„ã¾ã™ã€‚å¤–éƒ¨ã‹ã‚‰ã¯ `index.ts` ã‚’é€šã˜ã¦ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã€å†…éƒ¨ã®å®Ÿè£…è©³ç´°ï¼ˆç‰¹å®šã®Hooksã‚„å†…éƒ¨ãƒ‘ãƒ¼ãƒ„ï¼‰ã‚’éš è”½ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å½±éŸ¿ç¯„å›²ã‚’æœ€å°åŒ–ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ›  ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²ã®åŸºæº–

1. **æ„å‘³ã®ã‚ã‚‹å¡Šï¼ˆDomain Unitï¼‰:** éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒæŒ‡ã‚’å·®ã—ã¦åå‰ã‚’å‘¼ã¹ã‚‹å˜ä½ã‹ã€‚ã€Œã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã˜ã‚ƒãªã„äººï¼ˆPMã‚„é¡§å®¢ï¼‰ã«è¦‹ã›ãŸã¨ãã€å°‚é–€ç”¨èªã‚’ä½¿ã‚ãšã«ãã®å½¹å‰²ã‚’ä¸€è¨€ã§èª¬æ˜ã§ãã‚‹ã‹ï¼Ÿã€
2. **å˜ä¸€è²¬ä»»:** ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å½¹å‰²ã‚’ä¸€è¨€ã§èª¬æ˜ã§ãã‚‹ã‹ã€‚
3. **èªçŸ¥è² è·:** JSXãŒ150è¡Œã‚’è¶…ãˆã‚‹å ´åˆã€è¦ªã‚’ã€Œç›®æ¬¡ã€ã«ã™ã‚‹ãŸã‚ã«åˆ†å‰²ã€‚
4. **å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¢ƒç•Œ:** é«˜é »åº¦ã§æ›´æ–°ã•ã‚Œã‚‹ãƒ‘ãƒ¼ãƒ„ï¼ˆInput, Timerç­‰ï¼‰ã®éš”é›¢ã€‚

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

* **Domain Logic:** Vitestã«ã‚ˆã‚‹ç´”ç²‹é–¢æ•°ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã€‚
* **UI Parts:** Storybookã«ã‚ˆã‚‹ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç¢ºèªã€‚
* **Flow:** Playwrightã«ã‚ˆã‚‹E2Eãƒ†ã‚¹ãƒˆï¼ˆä¸»è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼‰ã€‚

---

### ğŸ’¡ é–‹ç™ºè€…ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã€ã€Œã‚³ãƒ¼ãƒ‰ã‚’ã©ã“ã«ç½®ãã‹ã€ã®è¿·ã„ã‚’æ¶ˆã—ã€æ©Ÿèƒ½è¿½åŠ ãŒã€Œæ—¢å­˜ã®ãƒ‘ã‚ºãƒ«ã®çµ„ã¿åˆã‚ã›ã€ã«ãªã‚‹çŠ¶æ…‹ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ“¡ ãƒ‡ãƒ¼ã‚¿å–å¾—æˆ¦ç•¥ (Data Fetching Strategy)

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Next.js App Routerã®ç‰¹æ€§ã‚’æ´»ã‹ã—ã€**ã€Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»å®‰å…¨æ€§ãƒ»UXã€**ã€€ã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã®3å±¤ã®ãƒ‡ãƒ¼ã‚¿å–å¾—æˆ¦ç•¥ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### 1. å–å¾—æ‰‹æ³•ã®ä½¿ã„åˆ†ã‘

| ã‚«ãƒ†ã‚´ãƒª | æ‰‹æ³• | ä¸»ãªç”¨é€” | å½¹å‰² |
| :--- | :--- | :--- | :--- |
| **Server Layer (RSC)** | `async/await` fetch | åˆæœŸè¡¨ç¤ºãƒ‡ãƒ¼ã‚¿, SEOã‚³ãƒ³ãƒ†ãƒ³ãƒ„ | JSå‰Šæ¸›ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±ã®ä¿è­· |
| **Interaction Layer (RCC)** | SWR / React Query | æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿, ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥, é«˜é€Ÿãªå†æ¤œè¨¼ |
| **Mutation Layer** | Server Actions | ãƒ‡ãƒ¼ã‚¿ã®ç™»éŒ²ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ | å‹å®‰å…¨ãªé€šä¿¡, ã‚µãƒ¼ãƒãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å³æ™‚æ›´æ–° |

### 2. ã‚³ã‚¢ãƒ»ãƒãƒªã‚·ãƒ¼

#### âœ… Fetch where you use it (å–å¾—ã®å±€æ‰€åŒ–)
Next.jsã®Request Dedupingã‚’æ´»ç”¨ã—ã€Propsãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã‚’é¿ã‘ã€ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆFeatureå±¤ï¼‰ã§ç›´æ¥fetchã‚’è¡Œã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç‹¬ç«‹æ€§ã‚’é«˜ã‚ã¦ã„ã¾ã™ã€‚

#### âœ… Zodã«ã‚ˆã‚‹ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
å¤–éƒ¨APIã‚„Server Actionsã®å…¥åŠ›å€¤ã¯ã€Œä¿¡é ¼ã§ããªã„ã‚‚ã®ã€ã¨å®šç¾©ã—ã¦ã„ã¾ã™ã€‚å…¨ã¦ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¯¾ã—ã¦ **Zod** ã«ã‚ˆã‚‹ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¸ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ãŒä¾µå…¥ã™ã‚‹ã®ã‚’é˜²ã„ã§ã„ã¾ã™ã€‚

```typescript
// features/user/api.ts
const userSchema = z.object({ id: z.string(), name: z.string() });
export const getUser = async (id: string) => {
  const res = await fetch(`.../users/${id}`);
  return userSchema.parse(await res.json()); // å¢ƒç•Œç·šã§ã‚¬ãƒ¼ãƒ‰
};

```

#### âœ… Streaming & Suspense

é‡ã„ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ã‚ˆã†ã€`Suspense` å¢ƒç•Œã‚’é©åˆ‡ã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æº–å‚™ãŒã§ããŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰é †æ¬¡è¡¨ç¤ºï¼ˆStreamingï¼‰ã•ã›ã€LCPï¼ˆLargest Contentful Paintï¼‰ã®æ”¹å–„ã‚’å›³ã£ã¦ã„ã¾ã™ã€‚

#### âœ… ã‚µãƒ¼ãƒãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ„å›³çš„ãªåˆ¶å¾¡

ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã«å¿œã˜ã¦ `revalidatePath` ã‚„ `revalidateTag` ã‚’ä½¿ã„åˆ†ã‘ã€Server Actions å®Ÿè¡Œå¾Œã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‘ãƒ¼ã‚¸ã‚’é©åˆ‡ã«ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

* **Static Data:** æ°¸ç¶šçš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆISRï¼‰
* **Dynamic Data:** æ“ä½œã®éƒ½åº¦ `revalidate` ã‚’è¡Œã†ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰æ›´æ–°

---